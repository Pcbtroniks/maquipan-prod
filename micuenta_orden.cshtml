@using System;
@using System.Configuration;
@using MySqlConnector;

@using MercadoPago.Config;
@using MercadoPago.Client.Preference;
@using MercadoPago.Resource.Preference;
@using MercadoPago.Client.Common;

@mSeguridad.CookieID()
@{
	decimal Total = 0, grandTotal = 0;
	decimal totalEnvio = 0;
	string tipoEnvio = "", nombreEnvio = "", productoEnvio = "", descripcionEnvio = "";
	string payment_id = mOrdenes.infoOrden(UrlData[0], "payment_id");
	string payment_status = mOrdenes.infoOrden(UrlData[0], "payment_status");
}

<!DOCTYPE html>
<html lang="es-mx">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow"/>
    <!-- Title -->
    <title>Mi orden</title>
    <!-- Bootstrap css -->
    <link rel="stylesheet" href="~/assets/css/bootstrap.min.css" />
    <!-- Fontawesome css -->
    <link rel="stylesheet" href="~/assets/css/fontawesome.all.min.css" />
    <!-- owl.carousel css -->
    <link rel="stylesheet" href="~/assets/css/owl.carousel.min.css" />
    <!-- owl.theme.default css -->
    <link rel="stylesheet" href="~/assets/css/owl.theme.default.min.css" />
    <!-- animate css -->
    <link rel="stylesheet" href="~/assets/css/animate.min.css" />
    <!-- meanmenu css -->
    <link rel="stylesheet" href="~/assets/css/meanmenu.min.css" />
    <!-- Style css -->
    <link rel="stylesheet" href="~/assets/css/style.css" />
    <!-- color css -->
    <link rel="stylesheet" href="~/assets/css/color.css" />
    <!-- Responsive css -->
    <link rel="stylesheet" href="~/assets/css/responsive.css" />

    <!-- Meta Pixel Code -->
    <script>
        !function (f, b, e, v, n, t, s) {
            if (f.fbq) return; n = f.fbq = function () {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
            n.queue = []; t = b.createElement(e); t.async = !0;
            t.src = v; s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1021577462753223');
        fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1021577462753223&ev=PageView&noscript=1" />
    </noscript>
    <!-- End Meta Pixel Code -->
    @mAnalitica.AnaliticaGoogle()
</head>

<body>

	@navegacion.Menu()

	<!-- Banner Area -->
	<section id="common_banner_one" style="background-image: url(/img/secciones/b_nosotros.jpg)">
		<div class="container ">
			<div class="row">
				<div class="col-lg-12">
					<div class="common_banner_text">
						<h2 style="color: black">Mi orden</h2>
						<ul>
							<li><a href="~/" style="color: black">Inicio</a></li>
							<li><i class="fas fa-slash" style="color: black"></i></li>
							<li class="active">Mi orden</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</section>
	@{
		if (mClientes.ObtenerValorCookie("c") == mClientes.ObtenerValorCookie("c"))
		{
			<section id="cart_area_three" class="ptb-100">
					<div class="container">
						<div class="row">
							<div class="col-lg-8 col-md-12 col-sm-12 col-12">
								<div class="table_desc">
									<div class="table_page table-responsive">
										<table>

											<!-- Start Cart Table Head -->
											<thead>
												<tr>
													<th class="product_thumb">Imagen</th>
													<th class="product_name">Producto</th>
													<th class="product-price">Precio</th>
													<th class="product_quantity">Cantidad</th>
												</tr>
											</thead>
											<!-- End Cart Table Head -->
											@{

												using (MySqlConnection CONN = new MySqlConnection(ConfigurationManager.ConnectionStrings["SDNS"].ConnectionString))
												{
													CONN.Open();
													using (MySqlCommand CMD = new MySqlCommand("SELECT * FROM artvent WHERE orden = @varIdOrden", CONN))
													{
														CMD.Parameters.AddWithValue("@varIdOrden", UrlData[0]);
														using (MySqlDataReader DATOS = CMD.ExecuteReader())
														{
															while (DATOS.Read())
															{
																decimal precio = Convert.ToDecimal(DATOS["precio"].ToString());
																//decimal preciodescuento = Convert.ToDecimal(DATOS["preciodescuento"].ToString());
																Total = Convert.ToDecimal(DATOS["precio"].ToString()) * Convert.ToDecimal(DATOS["cantidad"].ToString());

																//if (preciodescuento >= 1)
																//{
																//	Total = Convert.ToDecimal(DATOS["preciodescuento"].ToString()) * Convert.ToDecimal(DATOS["cantidad"].ToString());
																//}
																//else
																//{
																//	Total = Convert.ToDecimal(DATOS["precio"].ToString()) * Convert.ToDecimal(DATOS["cantidad"].ToString());

																//}


																if (DATOS["id_art"].ToString() == "envio")
																{
																	grandTotal = grandTotal + Total;
																	totalEnvio = Total;
																	tipoEnvio = DATOS["codigo"].ToString();

																	if (tipoEnvio == "r")
																	{
																		nombreEnvio = DATOS["nombre"].ToString();
																		productoEnvio = "";
																		descripcionEnvio = DATOS["talla"].ToString();
																	}

																}
																else
																{
																	grandTotal = grandTotal + Total;

																	<tbody>
																		<!-- Start Cart Single Item-->
																		<tr>
																			<td class="product_thumb">
																				<a href="product-single.html">
																					<img src="~/img/productos/@DATOS["id_art"]/1.jpg" alt="img">
																				</a>
																			</td>
																			<td class="product_name">
																				@mSeguridad.sslNombreDecodificar(DATOS["nombre"].ToString()), @DATOS["talla"] @DATOS["color"]
																			</td>
																			<td class="product-price">$@Convert.ToDecimal(DATOS["precio"].ToString()).ToString("N2")</td>
																			<td class="product_quantity">
																				Cant.: @Convert.ToDecimal(DATOS["cantidad"].ToString()).ToString("N0")
																			</td>
																		</tr> <!-- End Cart Single Item-->
																		<!-- Start Cart Single Item-->
																	</tbody>
																}

															}
														}
													}
												}
											}
										</table>
									</div>
								</div>
								<div class="cart_submit">
									<a href="~/micuenta" class="theme-btn-one btn-black-overlay btn_sm" type="submit">Regresar</a>
								</div>
							</div>

							<div class="col-lg-4 col-md-12">
								<div class="coupon_code left">
									<h3 style="color: black">Orden No. @UrlData[0] <br />Fecha de compra: <label style="color: white"> @mOrdenes.infoOrden(UrlData[0], "fecha")</label></h3>
									<div class="total_cart_inner">

										@if (payment_status == "approved")
										{
											<h5 style="font-size: 24px;">
												APROBADA
											</h5>
											<h5>
												No. Aprobación: <strong>@payment_id</strong>
											</h5>
										}
										<h5>Para:</h5>  <h6> @mOrdenes.infoOrden(UrlData[0], "e_para")</h6><br />

										<h5>Dirección de envío:</h5> <h6> @mOrdenes.infoOrden(UrlData[0], "e_calle"), @mOrdenes.infoOrden(UrlData[0], "e_exterior"), @mOrdenes.infoOrden(UrlData[0], "e_interior"), @mOrdenes.infoOrden(UrlData[0], "e_estado"),  @mOrdenes.infoOrden(UrlData[0], "e_colonia"), CP: @mOrdenes.infoOrden(UrlData[0], "e_codigopostal"), @mOrdenes.infoOrden(UrlData[0], "e_cruces")</h6><br />

										<h5>Observaciones:</h5><h6> @mOrdenes.infoOrden(UrlData[0], "e_cruces"), @mOrdenes.infoOrden(UrlData[0], "e_observacion") </h6>

										@if (tipoEnvio == "r")
										{
											<img src="~/img/location.png" width="40" />
											<h5 id="zIdMetodoEntrega" style="padding-left: 15px;">Recolección</h5>
										}
										else
										{
											<img src="~/img/enviar.png" width="40" />
											<h5 id="zIdMetodoEntrega" style="padding-left: 15px;">Envio</h5>
										}
										<div class="total_catr_three_bottom">
											@*<h5>Envio <span class="rigth_cart">$ @mOrdenes.infoOrden(UrlData[0], "envio")</span></h5>*@
											<h5>Total <span class="rigth_cart">$@grandTotal.ToString()</span></h5>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
			</section>

		}
		else
		{
			Response.Redirect("~/login");
		}
	}

	@navegacion.Footer()

	<!-- Jquery -->
	<script src="~/assets/js/jquery-3.6.0.min.js"></script>
	<!-- Bootstrap js -->
	<script src="~/assets/js/popper.min.js"></script>
	<script src="~/assets/js/bootstrap.min.js"></script>
	<!-- owl carousel js -->
	<script src="~/assets/js/owl.carousel.min.js"></script>
	<!-- Menu js -->
	<script src="~/assets/js/meanmenu.min.js"></script>
	<!-- img-upload js -->
	<script src="~/assets/js/img-upload.js"></script>
	<!-- Count js -->
	<script src="~/assets/js/count.js"></script>
	<!-- wow.js -->
	<script src="~/assets/js/wow.min.js"></script>
	<!-- Custom js -->
	<script src="~/assets/js/custom.js"></script>

</body>

</html>